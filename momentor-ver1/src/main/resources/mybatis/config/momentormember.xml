<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- MyBatis에서 namespace는 필수적으로 명시해야 함 -->
 <mapper namespace="member">   
 	<sql id="selectMomentorMember">
      		select memberId, memberPassword, memberName, birthYear, birthMonth, birthDay, nickName, memberEmail, gender, memberAddress
		from  MOMENTOR_MEMBER 
   </sql>
   <resultMap type="pnvo" id="physicalRM">
      <result property="momentorMemberVO.memberId" column="memberId" />
		<result property="momentorMemberVO.memberPassword" column="memberPassword" />
	    <result property="momentorMemberVO.memberName" column="memberName" />   
	    <result property="momentorMemberVO.birthYear" column="birthYear"/>
		<result property="momentorMemberVO.birthMonth" column="birthMonth"/>
		<result property="momentorMemberVO.birthDay" column="birthDay"/>
	    <result property="momentorMemberVO.nickName" column="nickName" />   
	    <result property="momentorMemberVO.auth" column="auth"/>
	    <result property="momentorMemberVO.memberEmail" column="memberEmail"/>
		<result property="momentorMemberVO.gender" column="gender"/>
		<result property="momentorMemberVO.memberAddress" column="memberAddress"/>
   </resultMap>
   
   <select id="login" parameterType="mvo" resultMap="physicalRM">
		select m.memberId, m.memberPassword, m.memberName, m.birthYear, m.birthMonth, m.birthDay, m.nickName, m.memberEmail, m.gender, m.memberAddress, m.auth, 
		p.MEMBERWEIGHT, p.MEMBERHEIGHT, p.age, p.bmi
		from momentor_member m, MOMEMTOR_MEMBER_PHYSICAL p
		where m.memberId=p.memberId and m.memberId=#{memberId} and m.memberPassword=#{memberPassword} and m.auth!=8
</select>   
	<insert id="registerMember" parameterType="mvo" >
		  INSERT INTO MOMENTOR_MEMBER 
      (MEMBERID, MEMBERPASSWORD, MEMBERNAME, BIRTHYEAR,BIRTHMONTH, BIRTHDAY, NICKNAME, MEMBEREMAIL, GENDER, MEMBERADDRESS)
      VALUES (#{memberId},#{memberPassword},#{memberName},#{birthYear},#{birthMonth},#{birthDay},#{nickName},#{memberEmail},#{gender},#{memberAddress})</insert>
   <insert id="registerPhysicalMember" parameterType="pnvo">
	    INSERT INTO MOMEMTOR_MEMBER_PHYSICAL
      (MEMBERWEIGHT,MEMBERHEIGHT,AGE,BMI,MEMBERID)
      VALUES(#{memberWeight},#{memberHeight},#{age},#{bmi},#{momentorMemberVO.memberId})
</insert>

	<select id="idCheck" resultType="mvo">
		select memberId from momentor_member where memberName=#{memberName} and memberEmail=#{memberEmail}
	</select>
	<select id="passCheck" resultType="mvo">
		select memberId, memberEmail, memberPassword from momentor_member where memberId=#{memberId} and memberEmail=#{memberEmail}
	</select>
	<select id="idOverlappingCheck" resultType="int">
      select count(*) from MOMENTOR_MEMBER where memberId=#{value}
      </select>
         <select id="nickNameOverlappingCheck" resultType="int">
      select count(*) from MOMENTOR_MEMBER where nickName=#{value}
      </select>
      
           <select id="myPageMemberInfo" resultMap="physicalRM">
		
		select m.memberId, m.memberPassword, m.memberName, m.birthYear, m.birthMonth, m.birthDay, m.nickName, m.memberEmail, m.gender, m.memberAddress, mf.memberWeight, mf.memberHeight, mf.age, mf.bmi
		from MOMENTOR_MEMBER m, MOMEMTOR_MEMBER_PHYSICAL mf
		where m.memberId=mf.memberId and m.memberId=#{memberId}
	</select>
	<select id="myPasswordCheck" resultType="int">
		select count(*) from MOMENTOR_MEMBER where memberPassword=#{memberPassword}
	</select>
	<update id="myPageMemberInfoUpdate" parameterType="mvo">
		update MOMENTOR_MEMBER
		set memberPassword=#{memberPassword}, memberName=#{memberName}, nickName=#{nickName}, memberEmail=#{memberEmail}, memberAddress=#{memberAddress}
		where memberId=#{memberId}  
	</update>
	<update id="myPageMemberPhysicalInfoUpdate" parameterType="pnvo">
		update MOMEMTOR_MEMBER_PHYSICAL
		set memberWeight=#{memberWeight}, memberHeight=#{memberHeight}, bmi=#{bmi}
		where memberId=#{momentorMemberVO.memberId}
	</update>
	<update id="myPageDeleteMemberInfo">
		update MOMENTOR_MEMBER 
		set auth = 8
		where memberId=#{value}
	</update>
	<delete id="myPageDeleteMemberPhysicalInfo">
		delete from MOMEMTOR_MEMBER_PHYSICAL where memberId=#{value}
	</delete>
 </mapper>
